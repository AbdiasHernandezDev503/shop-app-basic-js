<!DOCTYPE html>
<html lang="es">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Crear una cuenta - El Faro del Libro</title>

    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;500;600;700&display=swap"
      rel="stylesheet"
    />

    <!-- Tailwind -->
    <script src="https://cdn.tailwindcss.com"></script>

 
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
  </head>

  <body
    class="bg-[#F4EDE6] min-h-screen flex flex-col"
    style="font-family: 'Montserrat', sans-serif"
  >
  
    <header class="w-full py-4 px-6">
      <div class="flex items-center gap-3">
        <img
          onclick="window.location.href='/index.html'"
          src="../images/logo.png"
          alt="El Faro del Libro"
          class="w-32 h-auto"
        />
      </div>
    </header>

 
    <main class="flex-1 flex items-center justify-center">
      <div class="w-full max-w-md px-6">
        <h1
          class="text-2xl md:text-3xl font-semibold text-[#7B3A24] text-center mb-10"
        >
          Crear una cuenta
        </h1>

        <form id="registerForm" class="space-y-6" novalidate>
     
          <div class="space-y-1">
            <label class="block text-sm text-[#7B3A24]" for="nombre">
              Ingrese su nombre
            </label>
            <input
              id="nombre"
              name="nombre"
              type="text"
              required
              class="w-full border-b border-[#B8A79B] bg-transparent focus:outline-none focus:border-[#8A4A30] py-2 text-[#4A4A4A]"
              placeholder="Nombre completo"
            />
          </div>

    
          <div class="space-y-1">
            <label class="block text-sm text-[#7B3A24]" for="email">
              Ingrese su correo electrónico
            </label>
            <input
              id="email"
              name="email"
              type="email"
              required
              class="w-full border-b border-[#B8A79B] bg-transparent focus:outline-none focus:border-[#8A4A30] py-2 text-[#4A4A4A]"
              placeholder="correo@ejemplo.com"
            />
          </div>

          <div class="space-y-1">
            <label class="block text-sm text-[#7B3A24]" for="password">
              Ingrese su contraseña
            </label>
            <input
              id="password"
              name="password"
              type="password"
              required
              minlength="8"
              class="w-full border-b border-[#B8A79B] bg-transparent focus:outline-none focus:border-[#8A4A30] py-2 text-[#4A4A4A]"
              placeholder="Mínimo 8 caracteres"
            />
          </div>

        
          <div class="space-y-1">
            <label class="block text-sm text-[#7B3A24]" for="confirmPassword">
              Confirme su contraseña
            </label>
            <input
              id="confirmPassword"
              name="confirmPassword"
              type="password"
              required
              minlength="8"
              class="w-full border-b border-[#B8A79B] bg-transparent focus:outline-none focus:border-[#8A4A30] py-2 text-[#4A4A4A]"
              placeholder="Repita la contraseña"
            />
          </div>

     
          <div class="space-y-1">
            <label class="block text-sm text-[#7B3A24]" for="telefono">
              Ingrese su número de teléfono
            </label>
            <input
              id="telefono"
              name="telefono"
              type="tel"
              required
              minlength="8"
              class="w-full border-b border-[#B8A79B] bg-transparent focus:outline-none focus:border-[#8A4A30] py-2 text-[#4A4A4A]"
              placeholder="0000-0000"
            />
          </div>

      
          <div class="mt-6">
            <button
              type="button"
              class="w-full bg-[#556B5A] hover:bg-[#435446] text-white font-semibold py-2.5 rounded-md shadow-sm transition"
              onclick="registrarUsuario()"
            >
              Registrarse
            </button>
          </div>
        </form>
      </div>
    </main>

    <script type="module">
      import { db } from "../js/firebase-loader.js";
      import {
        ref,
        set,
      } from "https://www.gstatic.com/firebasejs/12.6.0/firebase-database.js";

      window.registrarUsuario = async function () {
        const form = document.getElementById("registerForm");

        const esValido = form.reportValidity();
        if (!esValido) return;

        const nombre = document.getElementById("nombre").value.trim();
        const email = document.getElementById("email").value.trim();
        const pass = document.getElementById("password").value.trim();
        const confirm = document.getElementById("confirmPassword").value.trim();
        const telefono = document.getElementById("telefono").value.trim();

        // VALIDAR CONTRASEÑAS
        if (pass !== confirm) {
          Swal.fire({
            title: "Contraseñas no coinciden",
            text: "Verifique que ambas contraseñas sean iguales.",
            icon: "error",
            confirmButtonColor: "#556B5A",
            background: "#F4EDE6",
            color: "#7B3A24",
          });
          return;
        }

       
        const userId = "usr_" + Date.now();

        
        const nuevoUsuario = {
          id: userId,
          nombre: nombre,
          correo: email,
          contrasena: pass,
          telefono: telefono,
          carrito: {},
          ordenes: {},
        };

        try {
        
          await set(ref(db, "usuarios/" + userId), nuevoUsuario);

          // MENSAJE DE ÉXITO
          Swal.fire({
            title: "Cuenta creada",
            text: "¡Tu cuenta ha sido creada con éxito!",
            icon: "success",
            confirmButtonText: "Iniciar sesión",
            confirmButtonColor: "#556B5A",
            background: "#F4EDE6",
            color: "#7B3A24",
          }).then(() => {
            window.location.href = "../index.html"; 
          });
        } catch (error) {
          console.error("Error creando usuario:", error);
          Swal.fire({
            title: "Error",
            text: "Hubo un problema creando la cuenta. Intente nuevamente.",
            icon: "error",
            confirmButtonColor: "#556B5A",
            background: "#F4EDE6",
            color: "#7B3A24",
          });
        }
      };
    </script>
  </body>
</html>
